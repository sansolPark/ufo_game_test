<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UFO ìš´ì„ í”¼í•˜ê¸°</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(to bottom, #001122, #003366);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }
        
        #gameContainer {
            position: relative;
            border: 2px solid #ffffff;
            background: linear-gradient(to bottom, #000033, #000066);
        }
        
        #gameCanvas {
            display: block;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        #ui {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #ffffff;
            font-size: 18px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        #instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffffff;
            text-align: center;
            font-size: 16px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        
        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff4444;
            text-align: center;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            display: none;
        }
        
        .blink {
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="ui">
            <div>ìƒì¡´ ì‹œê°„: <span id="timer">0</span>ì´ˆ</div>
        </div>
        <div id="instructions">
            <div>ğŸ›¸ UFO í˜œì„¤ í”¼í•˜ê¸° ğŸ›¸</div>
            <br>
            <div>PC: ì¢Œìš° í™”ì‚´í‘œí‚¤ë¡œ ì´ë™, ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ë¯¸ì‚¬ì¼ ë°œì‚¬</div>
            <div>ëª¨ë°”ì¼: í™”ë©´ ì¢Œìš° í„°ì¹˜ë¡œ ì´ë™, í™”ë©´ í„°ì¹˜ë¡œ ë¯¸ì‚¬ì¼ ë°œì‚¬</div>
            <br>
            <div class="blink">ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”!</div>
        </div>
        <div id="gameOver">
            <div>ğŸ’¥ GAME OVER ğŸ’¥</div>
            <br>
            <div>ìµœì¢… ìƒì¡´ ì‹œê°„: <span id="finalTime">0</span>ì´ˆ</div>
            <br>
            <div class="blink">ìŠ¤í˜ì´ìŠ¤ë°” ë˜ëŠ” í„°ì¹˜ë¡œ ì¬ì‹œì‘</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const timer = document.getElementById('timer');
        const instructions = document.getElementById('instructions');
        const gameOver = document.getElementById('gameOver');
        const finalTime = document.getElementById('finalTime');

        // ê²Œì„ ìƒíƒœ
        let gameState = 'waiting'; // 'waiting', 'playing', 'gameOver'
        let gameTime = 0;
        let lastTime = 0;

        // UFO ë„íŠ¸ë§µ (ë°˜ì›í˜•)
        const ufoPattern = [
            [0,0,0,1,1,1,1,1,1,1,0,0,0],
            [0,0,1,1,1,1,1,1,1,1,1,0,0],
            [0,1,1,2,1,1,1,1,1,2,1,1,0],
            [1,1,1,1,1,1,3,1,1,1,1,1,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1],
            [2,2,2,1,1,1,1,1,1,1,2,2,2]
        ];

        // ìƒ‰ìƒ ë§¤í•‘
        const colors = {
            0: 'transparent',
            1: '#cccccc',
            2: '#888888',
            3: '#ffff00'
        };

        // ê²Œì„ ì˜¤ë¸Œì íŠ¸
        const ufo = {
            x: canvas.width / 2 - 39, // UFO ì¤‘ì•™ ì •ë ¬
            y: canvas.height - 80,
            width: 78, // 13 * 6
            height: 36, // 6 * 6
            speed: 5
        };

        const asteroids = [];
        const asteroidSpeed = 3;
        const asteroidSpawnRate = 0.02;

        // ë¯¸ì‚¬ì¼
        const missiles = [];
        const missileSpeed = 8;
        let canShoot = true;
        const shootCooldown = 200; // ë°€ë¦¬ì´ˆ

        // UFO ê·¸ë¦¬ê¸°
        function drawUFO() {
            const pixelSize = 6;
            for (let row = 0; row < ufoPattern.length; row++) {
                for (let col = 0; col < ufoPattern[row].length; col++) {
                    const colorIndex = ufoPattern[row][col];
                    if (colorIndex !== 0) {
                        ctx.fillStyle = colors[colorIndex];
                        ctx.fillRect(
                            ufo.x + col * pixelSize,
                            ufo.y + row * pixelSize,
                            pixelSize,
                            pixelSize
                        );
                    }
                }
            }
        }

        // ë¯¸ì‚¬ì¼ ìƒì„±
        function createMissile() {
            return {
                x: ufo.x + ufo.width / 2 - 3, // UFO ì¤‘ì•™ì—ì„œ ë°œì‚¬
                y: ufo.y,
                width: 6,
                height: 12,
                speed: missileSpeed
            };
        }

        // ë¯¸ì‚¬ì¼ ê·¸ë¦¬ê¸° (ë„íŠ¸ ìŠ¤íƒ€ì¼)
        function drawMissile(missile) {
            const pixelSize = 3;
            const pattern = [
                [0,1,0],
                [1,1,1],
                [1,1,1],
                [0,1,0]
            ];

            for (let row = 0; row < pattern.length; row++) {
                for (let col = 0; col < pattern[row].length; col++) {
                    if (pattern[row][col] === 1) {
                        ctx.fillStyle = '#00ff00'; // ë…¹ìƒ‰ ë¯¸ì‚¬ì¼
                        ctx.fillRect(
                            missile.x + col * pixelSize,
                            missile.y + row * pixelSize,
                            pixelSize,
                            pixelSize
                        );
                    }
                }
            }
        }
        function createAsteroid() {
            return {
                x: Math.random() * (canvas.width - 30),
                y: -30,
                width: 20,
                height: 20,
                speed: asteroidSpeed + Math.random() * 2
            };
        }

        // ìš´ì„ ê·¸ë¦¬ê¸° (ë„íŠ¸ ìŠ¤íƒ€ì¼)
        function drawAsteroid(asteroid) {
            const pixelSize = 4;
            const pattern = [
                [0,1,1,0,0],
                [1,1,1,1,0],
                [1,1,1,1,1],
                [1,1,1,1,0],
                [0,1,1,0,0]
            ];

            for (let row = 0; row < pattern.length; row++) {
                for (let col = 0; col < pattern[row].length; col++) {
                    if (pattern[row][col] === 1) {
                        ctx.fillStyle = '#ff3333';
                        ctx.fillRect(
                            asteroid.x + col * pixelSize,
                            asteroid.y + row * pixelSize,
                            pixelSize,
                            pixelSize
                        );
                    }
                }
            }
        }

        // ë³„ ë°°ê²½ ê·¸ë¦¬ê¸°
        function drawStars() {
            ctx.fillStyle = '#ffffff';
            for (let i = 0; i < 50; i++) {
                const x = (i * 37) % canvas.width;
                const y = (i * 23 + gameTime * 0.5) % canvas.height;
                ctx.fillRect(x, y, 1, 1);
            }
        }

        // ì¶©ëŒ ê²€ì‚¬
        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // ê²Œì„ ì—…ë°ì´íŠ¸
        function update(currentTime) {
            if (gameState !== 'playing') return;

            const deltaTime = currentTime - lastTime;
            gameTime += deltaTime;

            // íƒ€ì´ë¨¸ ì—…ë°ì´íŠ¸
            timer.textContent = Math.floor(gameTime / 1000);

            // ìš´ì„ ìƒì„±
            if (Math.random() < asteroidSpawnRate) {
                asteroids.push(createAsteroid());
            }

            // ìš´ì„ ì—…ë°ì´íŠ¸
            for (let i = asteroids.length - 1; i >= 0; i--) {
                asteroids[i].y += asteroids[i].speed;

                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ìš´ì„ ì œê±°
                if (asteroids[i].y > canvas.height) {
                    asteroids.splice(i, 1);
                    continue;
                }

                // ì¶©ëŒ ê²€ì‚¬
                if (checkCollision(ufo, asteroids[i])) {
                    endGame();
                    return;
                }
            }

            // ë¯¸ì‚¬ì¼ ì—…ë°ì´íŠ¸
            for (let i = missiles.length - 1; i >= 0; i--) {
                missiles[i].y -= missiles[i].speed;

                // í™”ë©´ ë°–ìœ¼ë¡œ ë‚˜ê°„ ë¯¸ì‚¬ì¼ ì œê±°
                if (missiles[i].y < -missiles[i].height) {
                    missiles.splice(i, 1);
                    continue;
                }

                // ë¯¸ì‚¬ì¼ê³¼ ìš´ì„ ì¶©ëŒ ê²€ì‚¬
                for (let j = asteroids.length - 1; j >= 0; j--) {
                    if (checkCollision(missiles[i], asteroids[j])) {
                        // ë¯¸ì‚¬ì¼ê³¼ ìš´ì„ ëª¨ë‘ ì œê±°
                        missiles.splice(i, 1);
                        asteroids.splice(j, 1);
                        break;
                    }
                }
            }

            lastTime = currentTime;
        }

        // ë Œë”ë§
        function render() {
            // ë°°ê²½ ì§€ìš°ê¸°
            ctx.fillStyle = 'rgba(0, 0, 51, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ë³„ ê·¸ë¦¬ê¸°
            drawStars();

            // UFO ê·¸ë¦¬ê¸°
            if (gameState === 'playing') {
                drawUFO();
            }

            // ìš´ì„ ê·¸ë¦¬ê¸°
            asteroids.forEach(drawAsteroid);

            // ë¯¸ì‚¬ì¼ ê·¸ë¦¬ê¸°
            missiles.forEach(drawMissile);
        }

        // ê²Œì„ ì‹œì‘
        function startGame() {
            gameState = 'playing';
            gameTime = 0;
            lastTime = performance.now();
            asteroids.length = 0;
            missiles.length = 0; // ë¯¸ì‚¬ì¼ë„ ì´ˆê¸°í™”
            ufo.x = canvas.width / 2 - 39;
            instructions.style.display = 'none';
            gameOver.style.display = 'none';
        }

        // ê²Œì„ ì¢…ë£Œ
        function endGame() {
            gameState = 'gameOver';
            finalTime.textContent = Math.floor(gameTime / 1000);
            gameOver.style.display = 'block';
        }

        // ê²Œì„ ë£¨í”„
        function gameLoop(currentTime) {
            update(currentTime);
            render();
            requestAnimationFrame(gameLoop);
        }

        // í‚¤ë³´ë“œ ì…ë ¥
        const keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;

            if (e.code === 'Space') {
                e.preventDefault();
                if (gameState === 'waiting' || gameState === 'gameOver') {
                    startGame();
                } else if (gameState === 'playing' && canShoot) {
                    // ë¯¸ì‚¬ì¼ ë°œì‚¬
                    missiles.push(createMissile());
                    canShoot = false;
                    setTimeout(() => {
                        canShoot = true;
                    }, shootCooldown);
                }
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });

        // UFO ì´ë™ ì²˜ë¦¬
        function handleMovement() {
            if (gameState === 'playing') {
                if (keys['ArrowLeft'] && ufo.x > 0) {
                    ufo.x -= ufo.speed;
                }
                if (keys['ArrowRight'] && ufo.x < canvas.width - ufo.width) {
                    ufo.x += ufo.speed;
                }
            }
        }

        // í„°ì¹˜ ì…ë ¥ (ëª¨ë°”ì¼)
        let touchStartX = 0;
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            touchStartX = e.touches[0].clientX;
            
            if (gameState === 'waiting' || gameState === 'gameOver') {
                startGame();
            } else if (gameState === 'playing' && canShoot) {
                // ë¯¸ì‚¬ì¼ ë°œì‚¬
                missiles.push(createMissile());
                canShoot = false;
                setTimeout(() => {
                    canShoot = true;
                }, shootCooldown);
            }
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            if (gameState === 'playing') {
                const touchX = e.touches[0].clientX;
                const rect = canvas.getBoundingClientRect();
                const canvasX = (touchX - rect.left) * (canvas.width / rect.width);
                
                if (canvasX < canvas.width / 2) {
                    // ì™¼ìª½ í„°ì¹˜
                    if (ufo.x > 0) {
                        ufo.x -= ufo.speed;
                    }
                } else {
                    // ì˜¤ë¥¸ìª½ í„°ì¹˜
                    if (ufo.x < canvas.width - ufo.width) {
                        ufo.x += ufo.speed;
                    }
                }
            }
        });

        // ì´ë™ ì²˜ë¦¬ë¥¼ ìœ„í•œ ë³„ë„ ë£¨í”„
        function movementLoop() {
            handleMovement();
            requestAnimationFrame(movementLoop);
        }

        // ê²Œì„ ì‹œì‘
        gameLoop();
        movementLoop();

        // ìº”ë²„ìŠ¤ í¬ê¸° ì¡°ì • (ë°˜ì‘í˜•)
        function resizeCanvas() {
            const container = document.getElementById('gameContainer');
            const maxWidth = window.innerWidth - 40;
            const maxHeight = window.innerHeight - 40;
            
            if (maxWidth < 800 || maxHeight < 600) {
                const scale = Math.min(maxWidth / 800, maxHeight / 600);
                container.style.transform = `scale(${scale})`;
                container.style.transformOrigin = 'center center';
            } else {
                container.style.transform = 'none';
            }
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
    </script>
</body>
</html>
